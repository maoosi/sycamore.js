/*!
* sycamore.js 0.1.0 - A decision tree based chat library.
*
* @author       Todd Armstrong <todd@toddarmstrong.com.au>
* @homepage     https://github.com/toddarmstrong/sycamore.js#readme
* @copyright    Copyright (c) 2018 Todd Armstrong <todd@toddarmstrong.com.au>
* @license      MIT
* @version      0.1.0
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Sycamore=e()}(this,function(){"use strict";var t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},e=function(){function e(t,e){return o[t]=o[t]||[],o[t].push(e),this}function n(t,n){return n._once=!0,e(t,n),this}function i(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?o[t].splice(o[t].indexOf(e),1):delete o[t],this}function a(t){for(var e=this,n=arguments.length,a=Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];var s=o[t]&&o[t].slice();return s&&s.forEach(function(n){n._once&&i(t,n),n.apply(e,a)}),this}var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=Object.create(null);return t({},r,{on:e,once:n,off:i,emit:a})},n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(i){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,t),this.emitter=e();var r=void 0;r=a.speed&&"number"==typeof a.speed&&a.speed>=1&&a.speed<=10?a.speed:5;var o=void 0;o=a.delay&&"number"==typeof a.delay&&a.delay>=0?a.delay:0;var s=void 0;s=!!(a.delayMinMax&&Array.isArray(a.delayMinMax)&&2===a.delayMinMax.length&&a.delayMinMax[0]>0&&a.delayMinMax[1]>0&&a.delayMinMax[0]<a.delayMinMax[1])&&a.delayMinMax,this.options={speed:r,delay:o,delayMinMax:s,firstQuestion:a.firstQuestion||!1};var u=6;if(this.charactersPerSecond=2*u*(this.options.speed/10),this.currentQuestion=!1,this.answeredData=[],i instanceof Array)this.data=i;else if(i)throw new Error("Data is not an array.");return this}return i(t,[{key:"init",value:function(t){t?this._findAndAsk(t):this.options.firstQuestion?this._findAndAsk(this.options.firstQuestion):this._askQuestion(this.data[0])}},{key:"answer",value:function(t){this._answerQuestion(t)}},{key:"on",value:function(){var t;return(t=this.emitter).on.apply(t,arguments)}},{key:"off",value:function(){var t;return(t=this.emitter).off.apply(t,arguments)}},{key:"_findQuestionByID",value:function(t){var e=this;return new Promise(function(n,i){e.data.forEach(function(e){e.id===t&&n(e)}),i("No question found")})}},{key:"_calculateWait",value:function(t){var e=t.length,n=e/this.charactersPerSecond;return n*=1e3,n=Math.round(n)}},{key:"_askQuestion",value:function(t){var e=this;this.currentQuestion=t;var n=this._calculateWait(t.question);this.emitter.emit("typing",n),setTimeout(function(){e.emitter.emit("question",t)},n)}},{key:"_findAndAsk",value:function(t){var e=this;this._findQuestionByID(t).then(function(t){e._askQuestion(t)}).catch(function(t){throw new Error(t)})}},{key:"_calculateDelay",value:function(){return this.options.delayMinMax?Math.floor(Math.random()*(this.options.delayMinMax[1]-this.options.delayMinMax[0]+1)+this.options.delayMinMax[0]):this.options.delay}},{key:"_answerQuestion",value:function(t){var e=this,n={question:this.currentQuestion.question,answer:t.text};if(this.emitter.emit("answered",n),this.answeredData.push(n),this.emitter.emit("update",this.answeredData),t.callback){if("function"!=typeof t.callback)throw new Error("The callback for '"+t.text+"' is not a function");t.callback()}if(t.nextQuestion){var i=this._calculateDelay();this.emitter.emit("delay",i),setTimeout(function(){e._findAndAsk(t.nextQuestion)},i)}else this.emitter.emit("finished",this.answeredData)}}]),t}();return a});
//# sourceMappingURL=sycamore.js.map
